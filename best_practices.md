# üìò Project Best Practices

## 1. Project Purpose
Aplikasiku is a Flutter mobile application targeting the Indonesian locale (id_ID). The app includes authentication, a dashboard, finance-related features, liturgical details, notes, profile management, and statistics. Navigation is powered by GetX, and persistent storage is used for session/token handling. The project uses Material 3 theming and multiple UI libraries to deliver a modern experience.

## 2. Project Structure
- Entry point
  - `lib/main.dart`: App bootstrapper. Locks orientation to portrait, initializes Indonesian date formatting, sets Material 3 theme, configures localization, and launches the Splash screen via `GetMaterialApp`.
- Application layers (lib/)
  - `config/`: Environment and app configuration (e.g., base URLs, feature flags). Centralize environment-dependent values here.
  - `constants/`: Static constants, keys, and styles shared across the app.
  - `controllers/`: GetX or other controllers handling presentation logic and coordination (e.g., navigation_controller). Keep UI-free logic here.
  - `core/`: Core utilities, helpers, theming, routing, error types, and cross-cutting concerns.
  - `models/`: Domain and DTO models. Keep them immutable where possible and include JSON serialization if needed.
  - `presentation/`: UI layer.
    - `screens/`: Screen-specific widgets, each in a dedicated directory (e.g., `auth/`, `dashboard/`, `financial/`, `liturgical_detail/`, `notes/`, `profile/`, `splash_screen/`, `statistics/`).
    - `widgets/`: Reusable UI components shared across screens.
  - `services/`: API clients, persistence services (e.g., SharedPreferences), platform integrations, and domain services.
- Platform targets
  - `android/`, `ios/`, `web/`, `windows/`, `linux/`, `macos/`: Platform-specific scaffolding generated by Flutter.
- Assets
  - `assets/`: Images, SVGs, and other static resources. Declared in `pubspec.yaml`.
- Testing
  - `test/`: Flutter tests (currently includes default `widget_test.dart`).
- Configuration and tooling
  - `pubspec.yaml`: Dependencies, assets, and Flutter configuration.
  - `analysis_options.yaml`: Lint rules; extends `flutter_lints`.

Notes:
- A vendor `flutter/` directory is present containing upstream Flutter engine/docs sources. Treat as third-party vendor content. Avoid editing unless intentionally maintaining a vendored SDK.
- `ApiVersionMiddleware.php` exists in the repo root but is unrelated to the Flutter app. Keep it isolated from Flutter build and analysis.

## 3. Test Strategy
- Frameworks
  - Unit and widget tests use `flutter_test` (default). Add integration tests via the `integration_test` package when end-to-end coverage is required.
- Organization
  - Place tests under `test/` mirroring the `lib/` structure:
    - `test/unit/...` for pure Dart logic (models, services, controllers without Widgets).
    - `test/widget/...` for Widget tests (screens and shared widgets).
    - `integration_test/...` for app-level flows (authentication, navigation, network).
  - Test files end with `_test.dart`.
- Mocking & fakes
  - Prefer interface-driven design for services and repositories to enable mocking.
  - Recommended packages: `mocktail` or `mockito` for mocks; `flutter_test`‚Äôs `FakeAsync`/`WidgetTester` for time/UI.
- Philosophy
  - Unit tests: Fast, deterministic. Cover models (serialization, equality), pure services, and controller logic.
  - Widget tests: Validate layout, accessibility, and state transitions for screens/widgets.
  - Integration tests: Validate critical user journeys (e.g., Splash -> Auth -> Dashboard) and network error handling.
- Coverage
  - Aim for >80% on core business logic (models, services, controllers). Golden tests for critical UI components.
- Commands
  - Run all tests: `flutter test`
  - Run with coverage (desktop): `flutter test --coverage`

## 4. Code Style
- Language and linting
  - Dart SDK: ^3.5.1. Lints: `flutter_lints` (see `analysis_options.yaml`).
  - Use `const` constructors and `const` values where possible for performance.
  - Prefer `final` for variables that are assigned once.
  - Avoid using `print`; use a logging utility or GetX logger.
- Naming conventions
  - Files and directories: `snake_case.dart` (e.g., `sign_in_screen.dart`).
  - Classes: `PascalCase` (e.g., `SplashScreen`).
  - Variables, methods: `lowerCamelCase` (e.g., `checkToken`, `paymentProcessIllustration`).
  - Private members: prefix with `_` to mark library privacy.
- Documentation
  - Add doc comments (`///`) for public classes, methods, and any non-trivial logic in services/controllers.
  - Keep in-line comments concise; prefer self-documenting code and small, focused functions.
- Error and exception handling
  - Wrap IO and network calls (`http`) in `try/catch` and surface typed failures (e.g., custom `Failure` types) to the UI.
  - Decode API errors and handle timeouts/retries centrally in a service layer.
  - Avoid throwing raw exceptions from UI; convert to user-friendly messages.
- Asynchrony
  - Avoid long-running tasks in `build`; use `initState`, controllers, or services.
  - Cancel subscriptions on `dispose` where applicable.
- Localization
  - Default locale is Indonesian (`id_ID`). Use `intl` for date/number formatting and the configured `flutter_localizations` delegates.

## 5. Common Patterns
- State management and navigation
  - `GetMaterialApp` with GetX for navigation. Prefer named routes and middlewares for auth/guards.
  - Keep business logic in `controllers/` and `services/`, not Widgets.
- Services & repositories
  - Introduce service/repository interfaces to abstract HTTP, persistence, and platform APIs.
  - Centralize base URLs, headers, and token handling in the service layer.
- Models
  - Keep models immutable. Provide `fromJson`/`toJson` and equality (e.g., via `==` and `hashCode`). Consider code generation when scale increases.
- Persistence
  - SharedPreferences is currently used for session token. For sensitive data (access/refresh tokens), prefer `flutter_secure_storage`.
  - Centralize keys in `constants/`.
- Theming and design
  - Define color schemes and text styles in `core/` and apply via ThemeData. Reuse widgets from `presentation/widgets`.
- Testing patterns
  - Use golden tests for critical components in `presentation/widgets`.
  - Mock services in unit and widget tests; avoid real network calls.

## 6. Do's and Don'ts
- ‚úÖ Do
  - Use GetX navigation consistently (e.g., `Get.offAll`, `Get.toNamed`) with route definitions in one place.
  - Encapsulate API calls and persistence in `services/` with clear interfaces.
  - Keep Widgets small and compose UI from `presentation/widgets`.
  - Use `const` widgets and values to reduce rebuild costs.
  - Centralize magic strings, asset paths, and preference keys in `constants/`.
  - Handle token expiration gracefully (e.g., using `jwt_decoder`) and redirect to auth when invalid.
  - Validate null/empty states before navigating based on stored tokens.
  - Write tests for controllers/services and critical screens.
- ‚ùå Don‚Äôt
  - Mix business logic into Widgets; avoid heavy logic in `build` methods.
  - Store sensitive tokens in `SharedPreferences`. Use secure storage for secrets.
  - Mix multiple state management approaches without clear boundaries (e.g., Provider and GetX). Choose one per feature.
  - Hardcode environment-specific values in code; place them in `config/`.
  - Swallow exceptions; always log and surface actionable messages.

## 7. Tools & Dependencies
- Key libraries
  - Navigation/State: `get`
  - State (optional/legacy): `provider`
  - Networking: `http`
  - Persistence: `shared_preferences` (consider `flutter_secure_storage` for secrets)
  - Localization & formatting: `intl`, `flutter_localizations`, `month_year_picker`
  - UI: `google_fonts`, `flutter_svg`, `font_awesome_flutter`, `carousel_slider`, `smooth_page_indicator`, `page_transition`
  - Auth: `local_auth` (biometrics), `jwt_decoder`
  - Utilities: `package_info_plus`
- Setup
  - Install dependencies: `flutter pub get`
  - Run the app: `flutter run`
  - Analyze: `flutter analyze`
  - Test: `flutter test`

## 8. Other Notes
- Locale: The app targets Indonesian. Use `Intl` and ensure all user-facing strings are localizable.
- Splash flow: Splash checks a stored `token` in preferences and navigates accordingly. Ensure token validation (expiry, integrity) and prefer secure storage.
- Routing: Consider consolidating routes and middlewares in `core/` (e.g., `app_routes.dart`, `app_bindings.dart`).
- Security: Avoid committing secrets. Use env/config files for API endpoints and keys.
- Vendored Flutter SDK: If keeping `flutter/` as vendor content, treat it read-only and exclude from everyday development changes.
- LLM generation: Maintain the described folder boundaries, prefer GetX patterns already in use, and adhere to naming and localization conventions.
